<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tutorial 8: Initialisation pattern and Animation • jsReact</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../jquery.sticky-kit.min.js"></script><script src="../../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../../index.html">jsReact</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../index.html">Home</a>
</li>
<li>
  <a href="../../articles/index.html">Articles</a>
</li>
<li>
  <a href="../../articles/examples/gallery.html">Gallery</a>
</li>
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/kcf-jackson/jsReact">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Tutorial 8: Initialisation pattern and Animation</h1>
                        <h4 class="author">Jackson Kwok</h4>
            
            <h4 class="date">2017-11-30</h4>
          </div>

    
    
<div class="contents">
<style>
div.interface pre { background-color: #ffcccc; }
div.js pre { background-color: #D4EBFF; }
div.r pre { background-color: #c9ffc1; }
div.others pre { background-color: lightyellow; }
</style>
<hr>
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>1.1 Introduction</h2>
<p>We will start this tutorial by learning two techniques. The first one is a simple pattern that helps you initialise data in javascript. This comes in handy when you want to do a one-off passing of data from R to JS. The second one is to use the tweenR package to create data for animation. The idea is that transition animation is basically interpolation of frames.</p>
After that, we are going to build this app:
<div>
<p><img src="gif_images/example_8.gif" style="width:57%;height:400px;"></p>
</div>
<p>The code can be found <a href="https://github.com/kcf-jackson/jsReact/blob/master/inst/example_8.R">here</a>. (Note that this example comes from the <a href="https://github.com/thomasp85/tweenr">tweenr</a> package.)</p>
<hr>
</div>
<div id="two-techniques" class="section level2">
<h2 class="hasAnchor">
<a href="#two-techniques" class="anchor"></a>1.2 Two techniques</h2>
<div id="initialising-variables-in-js" class="section level3">
<h3 class="hasAnchor">
<a href="#initialising-variables-in-js" class="anchor"></a>1.2.1 Initialising variables in JS</h3>
<p>This technique comes in handy when you need to initialise some variables in JS using data in R. (And often those variables stay unchanged through out the session.) The first time I came across this is when I want to get the range of my data, but the data were still in R at the time when the app starts up.</p>
<p>We use the function <code>ws.open() { .. }</code>; this function gets called when the (websocket) connection between R and JS is made, which is roughly right after the app starts.</p>
<p>To initialise a variable in JS, we need the following:</p>
<ol style="list-style-type: lower-alpha">
<li>when the app starts, we request some data from R;</li>
<li>the R function needs to know how to handle this ‘init’ request;</li>
<li>the JS function needs to know how to handle this ‘init’ data.</li>
</ol>
<p>Both (b) and (c) can be achieved with a conditional-<code>if</code> statement.</p>
First, we start with the JS code.
<div class="js">
<pre><code>var my_init_data;
ws.open = function() {
  ws.send(JSON.stringify({init: true}))
}</code></pre>
<ul>
<li><p>The first line defines the variable we want to initialise;</p></li>
<li>
<code>ws.open()</code> sends a initialisation ‘request’ (the moment R successfully establishes a connection with JS), which is just a list with a variable called ‘init’. You may name the variable to whatever you like.</li>
</ul>
</div>
Next, we handle the R code.
<div class="r">
<pre><code>is_init &lt;- function(msg) { 'init' %in% names(msg) }
r_fun &lt;- function(msg) {
  if (is_init(msg)) {
    data_to_js &lt;- init_data  # some named list
    data_to_js %&lt;&gt;% append(list(init = "true"))
  } else {
    data_to_js &lt;- usual_data # some named list
    data_to_js %&lt;&gt;% append(list(init = "false"))
  }
  data_to_js
}</code></pre>
</div>
<ul>
<li>The first line defines a function to check if a list contains the ‘init’ tag.</li>
<li>If the data from JS contain the ‘init’ tag, then we pass the ‘init_data’ back with a ‘init = true’ tag. Otherwise, we pass the ‘usual_data’ with a ‘init = false’ tag.</li>
</ul>
<p>Finally, back to JS again.</p>
<div class="js">
<pre><code>ws.onmessage = function(msg) {
 var my_data = JSON.parse(msg.data);
 if (my_data.init == 'true') {
   my_init_data = my_data;
 } else {
  //do_something_with(my_data);
 }
}</code></pre>
<ul>
<li>When JS receives the data from R, it checks whether it has an ‘init’ tag, if so, it will put it into ‘my_init_data’, the variable that we want to initialise.</li>
</ul>
</div>
<p><em>Remark: The two JS codes are actually in the same file, I broke that into two pieces to illustrate the order things happen. Usually things start on the JS side, go through R, then end in JS.</em></p>
</div>
<div id="create-data-for-animation" class="section level3">
<h3 class="hasAnchor">
<a href="#create-data-for-animation" class="anchor"></a>1.2.2 Create data for animation</h3>
<hr>
</div>
</div>
<div id="design" class="section level2">
<h2 class="hasAnchor">
<a href="#design" class="anchor"></a>1.3 Design</h2>
<div id="app-interface" class="section level3">
<h3 class="hasAnchor">
<a href="#app-interface" class="anchor"></a>1.3.1 App interface</h3>
<p>Let’s inspect the interface:</p>
<p>Hm…does it look familar? Well, this app has the same interface as seen in <a href="example_2.html">tutorial 2</a>!</p>
<hr>
</div>
<div id="code" class="section level3">
<h3 class="hasAnchor">
<a href="#code" class="anchor"></a>1.3.2 Code</h3>
<hr>
<div id="html" class="section level4">
<h4 class="hasAnchor">
<a href="#html" class="anchor"></a>Html</h4>
</div>
<div id="javascript" class="section level4">
<h4 class="hasAnchor">
<a href="#javascript" class="anchor"></a>Javascript</h4>
<hr>
</div>
<div id="r-function" class="section level4">
<h4 class="hasAnchor">
<a href="#r-function" class="anchor"></a>R function</h4>
<hr>
</div>
<div id="others" class="section level4">
<h4 class="hasAnchor">
<a href="#others" class="anchor"></a>Others</h4>
</div>
</div>
</div>
<div id="app-as-a-function-call" class="section level2">
<h2 class="hasAnchor">
<a href="#app-as-a-function-call" class="anchor"></a>1.4 App as a function call</h2>
</div>
<div id="summary" class="section level2">
<h2 class="hasAnchor">
<a href="#summary" class="anchor"></a>1.5 Summary</h2>
<p>In this tutorial, we have learnt two techniques:</p>
<ul>
<li><p>For the html part, we added the <code>plotly.js</code> library and an extra container using <code>add_js_library</code> and <code>add_div</code>.</p></li>
<li><p>For the JS part, we added some codes to make a <code>plotly</code> plot (using the copy-and-paste ‘technique’!).</p></li>
</ul>
<p>Using these techniques, we created</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">1.1 Introduction</a></li>
      <li><a href="#two-techniques">1.2 Two techniques</a></li>
      <li><a href="#design">1.3 Design</a></li>
      <li><a href="#app-as-a-function-call">1.4 App as a function call</a></li>
      <li><a href="#summary">1.5 Summary</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Chun Fung (Jackson) Kwok.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
