<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tutorial 3b: Practicing with p5.js • jsReact</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../jquery.sticky-kit.min.js"></script><script src="../../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../../index.html">jsReact</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../index.html">Home</a>
</li>
<li>
  <a href="../../articles/index.html">Articles</a>
</li>
<li>
  <a href="../../articles/examples/gallery.html">Gallery</a>
</li>
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/kcf-jackson/jsReact">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Tutorial 3b: Practicing with p5.js</h1>
                        <h4 class="author">Jackson Kwok</h4>
            
            <h4 class="date">2017-12-13</h4>
          </div>

    
    
<div class="contents">
<style>
div.interface pre { background-color: #ffcccc; }
div.js pre { background-color: #D4EBFF; }
div.r pre { background-color: #c9ffc1; }
div.others pre { background-color: lightyellow; }
</style>
<hr>
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>1.1 Introduction</h2>
<p>After learning the basics of <code>p5.js</code> in tutorial <a href="https://rawgit.com/kcf-jackson/jsReact/master/vignettes/example_3.html">3a</a>, we are now ready to make this app:</p>
<div align="center">
<p><img src="gif_images/example_3.gif" style="width:70%;height:400px;"></p>
</div>
<p>The code for the app can be found <a href="https://github.com/kcf-jackson/jsReact/blob/master/inst/example_3.R">here</a>.</p>
<hr>
</div>
<div id="design" class="section level2">
<h2 class="hasAnchor">
<a href="#design" class="anchor"></a>1.2 Design</h2>
<p>We analyse the app interface and the code separately as usual.</p>
<div id="app-interface" class="section level3">
<h3 class="hasAnchor">
<a href="#app-interface" class="anchor"></a>1.2.1 App interface</h3>
<div class="figure">
<img src="example_3b_images/app_interface.png" style="width:70.0%">
</div>
<div id="layout" class="section level4">
<h4 class="hasAnchor">
<a href="#layout" class="anchor"></a>Layout</h4>
<p>This app adopts a two-column view. In the first column, we have a title and a container (i.e. a <code>&lt;div&gt;</code>), and in the second column, we just have a container. From time to time, it still surprises me to see how simple an app really is. Things look much less “magical” once you develop the right mental framework!</p>
</div>
<div id="behaviour" class="section level4">
<h4 class="hasAnchor">
<a href="#behaviour" class="anchor"></a>Behaviour</h4>
<p>Left canvas: Input</p>
<ul>
<li><p><span class="math inline">\(\beta_1\)</span> = <span class="math inline">\(10 \;\times\)</span> <span class="math inline">\(x\)</span>-coordinate on the canvas</p></li>
<li><p><span class="math inline">\(\beta_2\)</span> = <span class="math inline">\(y\)</span>-coordinate on the canvas</p></li>
</ul>
<p>Right plot: Output</p>
<ul>
<li><p><span class="math inline">\(x\)</span>: from -100 to 100 at a step of 1.</p></li>
<li><p><span class="math inline">\(f(x)\)</span>: <span class="math inline">\(\sigma(\beta_1 + \beta_2 x)\)</span>, where <span class="math inline">\(\sigma(z) = \dfrac{e^z}{1 + e^z}\)</span>.</p></li>
</ul>
<hr>
</div>
</div>
<div id="code" class="section level3">
<h3 class="hasAnchor">
<a href="#code" class="anchor"></a>1.2.2 Code</h3>
<p>In the last tutorial, we introduced the idea of isolating R code from JS code. This separates the interface development and the behaviour development, making it more clear which code is responsible for which component. In the following, you will see we have replaced our usual <code>add_script</code> by <code>add_script_from_file</code>.</p>
<div id="html" class="section level4">
<h4 class="hasAnchor">
<a href="#html" class="anchor"></a>Html</h4>
<div class="interface">
<pre><code>my_html &lt;- create_html() %&gt;%
  add_js_library(c("plotly", "p5")) %&gt;%
    add_column(id = "column_1") %&gt;%
      add_title("Parameter domain", into = "column_1") %&gt;%
      add_div(id = "p5_canvas", into = "column_1") %&gt;%
    add_column(id = "column_2") %&gt;%
      add_div(id = "plotly_plot", into = "column_2") %&gt;%
  add_style(
    ".column { float:left; }
    h3 { margin-top: 2cm; }"
  ) %&gt;%
  add_script_from_file("example_3.js")</code></pre>
</div>
<p>This part is just typing out what we saw. Actually, it is a key feature of the package to think about the web design process using more plain-english syntax.</p>
<ol style="list-style-type: decimal">
<li>we create a html documnet (<code>create_html</code>) and include the plotly.js and p5.js libraries (<code>add_js_library</code>);</li>
<li>add two columns (<code>add_column</code>); we add a title(<code>add_title</code>) and a div(<code>add_div</code>) in the first one and just a div in the second one (note that we have assigned ids <code>p5_canvas</code> and <code>plotly_plot</code> to the div’s for future reference);</li>
<li>lastly we add style (<code>add_style</code>) and JS script (<code>add_script_from_file</code>).</li>
</ol>
<p>For the styling, as the document does not know if we want the columns to be side-by-side or that one stacks on top of the other, we have to specify <code>.column { float:left; }</code>. This tells the html to put the columns side-by-side as long as there is space. On the other hand, <code>h3 { margin-top: 2cm; }</code> refers to putting some extra space above the title. We include that to make the app look nicer.</p>
<hr>
</div>
<div id="r" class="section level4">
<h4 class="hasAnchor">
<a href="#r" class="anchor"></a>R</h4>
<div class="r">
<pre><code>my_r_fun &lt;- function(msg) {
  beta_1 &lt;- msg$x * 10
  beta_2 &lt;- msg$y
  x &lt;- seq(-100, 100, length.out = 100)
  y &lt;- boot::inv.logit(beta_1 + beta_2 * x)
  list(x = x, y = y)
}</code></pre>
</div>
<p>This function takes the coordinate on the left canvas (stored in <code>msg</code>), evaluates the corresponding sigmoid function on a fixed set of points, then returns the data to JS for plotting.</p>
<hr>
</div>
<div id="js-code" class="section level4">
<h4 class="hasAnchor">
<a href="#js-code" class="anchor"></a>JS code</h4>
<div class="js">
<pre><code>ws.onmessage = function(msg) {
  var data0 = JSON.parse(msg.data);
  var trace1 = {
    x: data0['x'], y: data0['y'], mode: 'markers', type: 'scatter'
  };
  var layout = {
    title: 'Geometry of the sigmoid function',
    xaxis: {range: [-100, 100]}, yaxis: {range: [-0.5, 1.5]}
  };
  Plotly.newPlot('plotly_plot', [trace1], layout);
};</code></pre>
<p>This function makes a plot whenever it receives data from R. We use plotly to do that, and this part is the same as the previous <a href="example_2.html">tutorial</a>.</p>
<pre><code>var canvas_width = 200, canvas_height = 200;
function setup() {
  var my_canvas = createCanvas(canvas_width, canvas_height);
  my_canvas.parent('p5_canvas');
  draw_bg();
}
function draw() {
  if (mouseIsPressed) {
    draw_bg();
    draw_pt();
  }
}</code></pre>
<p>Recall that <code>setup()</code> sets up the canvas, and <code>draw()</code> draws on the canvas 60 times a second.</p>
<ul>
<li><p>In the body of <code>setup()</code>, we create the canvas (<code>createCanvas</code>), put that canvas in the div we named ‘p5_canvas’, then call a draw background function which we will implement later.</p></li>
<li><p>In the body of <code>draw()</code>, we specify that if the mouse is pressed (<code>mouseIsPressed</code>), then we redraw the background and draw a circle at the mouse position. The reason for redrawing the background is to clean up the circle at my previous mouse position.</p></li>
</ul>
<pre><code>function draw_bg() {
  rect(0, 0, canvas_width-1, canvas_height-1);
  line(canvas_width / 2, 0, canvas_width / 2, canvas_height);
  line(0, canvas_height / 2, canvas_width, canvas_height / 2);
}
function draw_pt() {
  ellipse(mouseX, mouseY, 10, 10);
  var json_msg_to_r = {
    'x': map(mouseX, 0, canvas_width, -1, 1),
    'y': map(mouseY, canvas_height, 0, -1, 1)
  };
  ws.send(JSON.stringify(json_msg_to_r));
}</code></pre>
<p>Finally, <code>draw_bg()</code></p>
<ul>
<li>draws the background by drawing a rectangle (<code>rect</code>) having the same size of the canvas. The reason we have -1 for both ‘canvas_width’ and ‘canvas_height’ is that a line is 1px thick, and we have to make space for it.</li>
<li>Following the background, we add two lines (<code>line</code>) to the canvas serving as the x-y axis.</li>
</ul>
<p><code>draw_pt()</code></p>
<ul>
<li><p>draws a circle (<code>ellipse</code>) at the mouse position with width and height set to 10.</p></li>
<li><p>Then, we postprocess the point we pick, and send the data to R (<code>ws.send</code>). Do make sure your named list matches how you referred to the variables in R! On a sidenote, we used <code>map(coord, s_min, s_max, t_min, t_max)</code> to scale the coordinate linearly from the range [s_min, s_max] to [t_min, t_max]. We could have done this in R instead, but the function <code>map</code> is quite handy, so we may as well do it in JS.</p></li>
</ul>
</div>
<hr>
</div>
<div id="others" class="section level4">
<h4 class="hasAnchor">
<a href="#others" class="anchor"></a>Others</h4>
<div class="others">
<pre><code># Example 3. Explore R-JS interaction with p5.js and plotly.js.
rm(list = ls())
library(jsReact)
library(magrittr)</code></pre>
<p>This part is the usual setup. It’s my personal habit to clean the environment before doing anything, but you don’t have to do that.</p>
<pre><code><a href="../../reference/preview_app.html">preview_app(my_html, my_r_fun, server = T)</a></code></pre>
<p><code>preview_app</code> is a new function i created to combine the three function calls (<code>write_html_to_file</code>, <code>create_app</code> and <code>start_app</code>) in one call, saving the html file as a temporary file. This simplifies workflow a bit further.</p>
</div>
</div>
</div>
</div>
<div id="summary" class="section level2">
<h2 class="hasAnchor">
<a href="#summary" class="anchor"></a>1.3 Summary</h2>
<p>In this tutorial, we did some practice on creating an app with <code>p5.js</code>. Hopefully you are now more familiar with</p>
<ul>
<li><p>how to setup a <code>p5</code> canvas using <code>setup()</code> and <code>draw()</code>,</p></li>
<li><p>the R-JS app development workflow.</p></li>
</ul>
<p>To conclude, while this is a simple example, it shares the same structure as the other apps that we are going to build, so make sure you understand this app well! Looking back, this app only takes about 60 lines; later on we will see we don’t have to write too much more to build something more serious; for example, the KNN classification app takes about 80 lines only. In fact, this is the app we will build in the next tutorial. See you then!</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">1.1 Introduction</a></li>
      <li><a href="#design">1.2 Design</a></li>
      <li><a href="#summary">1.3 Summary</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Chun Fung (Jackson) Kwok.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
