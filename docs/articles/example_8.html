<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tutorial 8: Initialisation pattern and Animation • jsReact</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">jsReact</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/example_1.html">Tutorial 1: R talks to JavaScript</a>
    </li>
    <li>
      <a href="../articles/example_2.html">Tutorial 2: Interactive plotting</a>
    </li>
    <li>
      <a href="../articles/example_3.html">Tutorial 3a: A 15 minutes introduction to p5.js</a>
    </li>
    <li>
      <a href="../articles/example_3b.html">Tutorial 3b: Practicing with p5.js</a>
    </li>
    <li>
      <a href="../articles/example_8.html">Tutorial 8: Initialisation pattern and Animation</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/kcf-jackson/jsReact">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Tutorial 8: Initialisation pattern and Animation</h1>
                        <h4 class="author">Jackson Kwok</h4>
            
            <h4 class="date">2017-11-28</h4>
          </div>

    
    
<div class="contents">
<hr>
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>1.1 Introduction</h2>
<div id="introduction-1" class="section level3">
<h3 class="hasAnchor">
<a href="#introduction-1" class="anchor"></a>Introduction</h3>
<p>In this tutorial, we are going to learn about two techniques. The first one is a simple pattern that allows you to initialise data in javascript. This comes in handy when you want to do a one-off passing of data from R to JS. The second one is to use the tweenR package to create data for animation. The idea is that transition animation is basically interpolation of frames.</p>
The app we are going to build looks like this:
<div>
<p><img src="gif_images/example_8.gif" style="width:49%;height:400px;"></p>
</div>
<p>The code can be found <a href="https://github.com/kcf-jackson/jsReact/blob/master/inst/example_8.R">here</a>.</p>
<hr>
</div>
</div>
<div id="two-techniques" class="section level2">
<h2 class="hasAnchor">
<a href="#two-techniques" class="anchor"></a>1.2 Two techniques</h2>
<div id="initialising-data-in-js" class="section level3">
<h3 class="hasAnchor">
<a href="#initialising-data-in-js" class="anchor"></a>1.2.1 Initialising data in JS</h3>
<p>This technique comes in handy when you need to initialise some variables in JS using data in R. (And often those variables stay unchanged through out the session.) The first time I came across this is when I want to get the range of my data, but the data were in R when the app starts up.</p>
<p>We use the function <code>ws.open</code></p>
<ol style="list-style-type: lower-alpha">
<li>When the app starts, it requests some data from R.</li>
<li>the R function needs to know how to handle ‘special’ request</li>
<li>the JS function needs to know how to handle ‘special’ data This can be achieved with a conditional statement.</li>
</ol>
<pre><code>var my_init_data;
ws.open = function() {
  ws.send(JSON.stringify({init: true}))
}</code></pre>
<pre><code>ws.onmessage = function(msg) {
 var my_data = JSON.parse(msg.data);
 if (my_data.init == 'true') {
   my_init_data = my_data;
 } else {
  do_something_with(my_data);
 }
}</code></pre>
<pre><code>is_init &lt;- function(msg) { 'init' %in% names(msg) }
r_fun &lt;- function(msg) {
  if (is_init(msg)) {
    data_to_js &lt;- init_data  # some named list
    data_to_js %&lt;&gt;% append(list(init = "true"))
  } else {
    data_to_js &lt;- usual_data # some named list
    data_to_js %&lt;&gt;% append(list(init = "false"))
  }
  data_to_js
}</code></pre>
</div>
<div id="create-data-for-animation" class="section level3">
<h3 class="hasAnchor">
<a href="#create-data-for-animation" class="anchor"></a>1.2.2 Create data for animation</h3>
</div>
</div>
<div id="design" class="section level2">
<h2 class="hasAnchor">
<a href="#design" class="anchor"></a>1.2 Design</h2>
<div id="app-interface" class="section level3">
<h3 class="hasAnchor">
<a href="#app-interface" class="anchor"></a>1.2.1 App interface</h3>
<p>Let’s inspect the interface:</p>
<p>Well, this app has <em>exactly the same</em> interface as seen in tutorial 2!</p>
<hr>
</div>
<div id="code" class="section level3">
<h3 class="hasAnchor">
<a href="#code" class="anchor"></a>1.2.2 Code</h3>
<hr>
<div id="html" class="section level4">
<h4 class="hasAnchor">
<a href="#html" class="anchor"></a>Html</h4>
</div>
<div id="javascript" class="section level4">
<h4 class="hasAnchor">
<a href="#javascript" class="anchor"></a>Javascript</h4>
<hr>
</div>
<div id="r-function" class="section level4">
<h4 class="hasAnchor">
<a href="#r-function" class="anchor"></a>R function</h4>
<hr>
</div>
<div id="others" class="section level4">
<h4 class="hasAnchor">
<a href="#others" class="anchor"></a>Others</h4>
<hr>
</div>
</div>
<div id="simple-modification" class="section level3">
<h3 class="hasAnchor">
<a href="#simple-modification" class="anchor"></a>1.2.3 Simple modification</h3>
<p>If you don’t like the idea of sliders, we can remove that and replace it by a timer to send some random data to R a few times a second (so that the plot updates by itself). The timer function is given by <code>setInterval(fun, t)</code>. It calls the function <code>fun</code> once every <code>t</code> milli-secs. (Note that once every 100 milli-seconds = 1 second 10 times.)</p>
<pre><code>var myVar = setInterval(animate_frame, 100);
function animate_frame() {
  ws.send(60 + Math.random() * 10);
}</code></pre>
<p>For simplicity, we just insert this code at the beginning of the Javascript, keeping the slider in the app. This is what we get:</p>
<div class="figure">
<img src="gif_images/example_2b.gif" style="width:50.0%">
</div>
<hr>
<p>## 1.3 Summary</p>
<p>In this tutorial, we have learnt how to make a <code>plotly</code> plot using JS and have it respond to slider events.</p>
<ul>
<li><p>For the html part, we added the <code>plotly.js</code> library and an extra container using <code>add_js_library</code> and <code>add_div</code>.</p></li>
<li><p>For the JS part, we added some codes to make a <code>plotly</code> plot (using the copy-and-paste ‘technique’!).</p></li>
<li><p>For the R part, we made R return a list of x, y coordinates.</p></li>
</ul>
<p>As an extension, we learnt about timer events triggered by <code>setInterval(fun, t)</code>, which runs the function <code>fun</code> once every <code>t</code> milli-seconds. Overall, this tutorial prepares us for animation-type visualisation. From here one could head to example 3, where we will learn about another JS library (<code>p5.js</code>) to create some common visual effects, or example 8, where we will create animated plots using simulated / real data. See you in the next tutorial!</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">1.1 Introduction</a></li>
      <li><a href="#two-techniques">1.2 Two techniques</a></li>
      <li><a href="#design">1.2 Design</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Chun Fung (Jackson) Kwok.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
